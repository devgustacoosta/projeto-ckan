<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="containerMapa">
    <h2>Filter by location</h2>
    <select id="location-search"></select>
    <div id="map"></div>
</div>

<script>
    const map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    $('#location-search').select2({
        placeholder: 'Enter location...',
        minimumInputLength: 3,
        ajax: {
            url: "https://nominatim.openstreetmap.org/search",
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    q: params.term,
                    format: "json",
                    addressdetails: 1,
                    limit: 5
                };
            },
            processResults: function (data) {
                return {
                    results: data.map(function (item) {
                        return {
                            id: item.place_id,
                            text: item.display_name,
                            lat: item.lat,
                            lon: item.lon
                        };
                    })
                };
            }
        }
    });

    $('#location-search').on('select2:select', function (e) {
        const selected = e.params.data;
        const lat = selected.lat;
        const lon = selected.lon;

        map.setView([lat, lon], 14);
        L.marker([lat, lon]).addTo(map).bindPopup(selected.text).openPopup();
    });
</script>